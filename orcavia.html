<!DOCTYPE html>
<html lang="en-CA">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-en="Bilingual Web Application" data-fr="Application Web Bilingue">Bilingual Web Application</title>
    <meta name="description" data-en="A bilingual web application template with Bootstrap 5.3" data-fr="Un modèle d'application web bilingue avec Bootstrap 5.3" content="A bilingual web application template with Bootstrap 5.3">
    
    <!-- Bootstrap 5.3 CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Custom CSS for accessibility and styling -->
    <link href="css/creavia.css" rel="stylesheet">

   <style>
        .record-card {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin-bottom: 20px;
            background: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .record-header {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #dee2e6;
            border-radius: 8px 8px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .record-body {
            padding: 20px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.875rem;
            font-weight: 500;
            margin-left: 10px;
        }
        
        .status-complete {
            background: #d4edda;
            color: #155724;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .update-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
        }
        
        .update-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
        
        .file-upload {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .load-options {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 15px 0;
        }
        
        .divider {
            color: #6c757d;
            font-weight: 500;
        }
        
        .no-records {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }
        
        .alert {
            margin-bottom: 20px;
            border-radius: 4px;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        #file-upload {
            display: none;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .record-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Skip to content link for accessibility -->
    <a href="#main-content" class="skip-link" data-en="Skip to main content" data-fr="Passer au contenu principal">Skip to main content</a>
    
    <!-- Navigation Header -->
    <header>
        <nav class="navbar navbar-expand-lg" role="navigation" aria-label="Main navigation">
            <div class="container">
                <!-- Brand/Logo -->
                <div class="navbar-brand d-flex align-items-center">
                    <img src="img/orca.png" alt="" class="me-2" style="height: 50px; width: auto;">
                    <span data-en="Orcavia" data-fr="Orcavia">Orcavia</span>
                </div>
                
                <!-- Mobile menu toggle button -->
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
                        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation menu">
                    <span class="navbar-toggler-icon"></span>
                    <span class="sr-only" data-en="Toggle navigation menu" data-fr="Basculer le menu de navigation">Toggle navigation menu</span>
                </button>
                
                <!-- Navigation menu -->
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0" role="menubar">
                        <li class="nav-item" role="none">
                            <a class="nav-link active" href="index.html" role="menuitem" aria-current="page" data-en="Home" data-fr="Accueil">Home</a>
                        </li>
                        <li class="nav-item" role="none">
                            <a class="nav-link" href="#" role="menuitem" 
                               data-en="About" data-fr="À propos">About</a>
                        </li>
                    </ul>
                    
                    <!-- Theme Toggle and Language Switcher -->
                    <div class="language-switcher" role="group" aria-label="Settings">
                        <!-- Theme toggle -->
                        <button type="button" class="theme-toggle" id="theme-toggle" 
                                aria-label="Toggle dark/light theme" 
                                data-en-light="Switch to Dark mode" 
                                data-fr-light="Passer au mode sombre"
                                data-en-dark="Switch to Light mode" 
                                data-fr-dark="Passer au mode clair">
                            <span id="theme-text" data-en="Dark mode" data-fr="Mode sombre">Dark mode</span>
                        </button>
                        
                        <!-- Language Switcher -->
                        <button type="button" class="btn btn-outline-primary btn-sm" 
                                data-lang="fr-CA" aria-pressed="false" 
                                aria-label="Passer au français" 
                                id="lang-fr-btn" style="display: none;">
                                <span data-en="Français" data-fr="Français">Français</span>
                        </button>
                        <button type="button" class="btn btn-outline-primary btn-sm" 
                                data-lang="en-CA" aria-pressed="false" 
                                aria-label="Switch to English" 
                                id="lang-en-btn">
                                <span data-en="English" data-fr="English">English</span>
                        </button>
                    </div>
                </div>
            </div>
        </nav>
    </header>
    
    <!-- Main Content -->
    <main id="main-content" class="container" role="main">
        <section aria-labelledby="main-heading">
            <h1 data-en="Mass Casualty Commission Data Management Tool" data-fr="Gestionnaire de données JSON – Commission sur les pertes massives">Mass Casualty Commission Data Management Tool</h1>
        </section>

        <div class="row">
            <div class="col-12">
                <div id="alerts-container"></div>
                
                <!-- File Upload Section -->
                <div class="file-upload">
                    <h3 data-en="Load JSON Data" data-fr="Charger les données JSON">Load JSON Data</h3>
                    <input type="file" id="file-upload" accept=".json">
                    <div class="load-options">
                        <label for="file-upload" class="btn btn-primary" data-en="Choose File" data-fr="Choisir le fichier">Choose File</label>
                        <span class="divider" data-en="OR" data-fr="OU">OR</span>
                        <button class="btn btn-secondary" id="load-from-url-btn" data-en="Load from Website" data-fr="Charger depuis le site web">Load from Website</button>
                    </div>
                    <p class="text-muted" data-en="Select a JSON file or load directly from the RCMP website" data-fr="Sélectionner un fichier JSON ou charger directement depuis le site web de la GRC">Select a JSON file or load directly from the RCMP website</p>
                </div>
                
                <!-- Action Buttons -->
                <div class="mb-4">
                    <button class="btn btn-success me-2" id="add-record-btn" data-en="Add New Record" data-fr="Ajouter un nouvel enregistrement">Add New Record</button>
                    <button class="btn btn-outline-primary" id="download-btn" data-en="Download JSON" data-fr="Télécharger JSON">Download JSON</button>
                </div>
                
                <!-- Records Container -->
                <div id="records-container"></div>
            </div>
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="mt-auto" role="contentinfo">
        <div class="container">
            <div class="text-center">
                <p class="mb-0" data-en="Web Communications Team tool" 
                   data-fr="Outil de l'équipe de communication Web">
                    Web Communications Team tool
                </p>
            </div>
        </div>
    </footer>
    
    <!-- Bootstrap 5.3 JS -->
    <script src="js/bootstrap.bundle.min.js"></script>
    
    <!-- Enhanced JavaScript with Theme Support -->
    <script src="js/creavia.js"></script>
  
   <!-- RCMP Data Editor JavaScript -->
    <script>
        class RCMPDataEditor {
            constructor() {
                this.data = { data: [] };
                this.themeMapping = {
                    'Culture and accountability': 'Culture et reddition de comptes',
                    'Firearms': 'Armes à feu',
                    'Gender-based violence and intimate partner violence': 'La violence fondée sur le sexe et la violence exercée par les partenaires intimes',
                    'Governance': 'Gouvernance',
                    'Information sharing': 'Communication d\'information',
                    'Managing crises': 'Gestion de crises',
                    'Organizational standards': 'Normes organisationnelles',
                    'Partnerships and engagement': 'Partenariats et engagement',
                    'Resourcing and recruitment': 'Ressources et recrutement',
                    'Training': 'Formation'
                };
                this.reversedThemeMapping = Object.fromEntries(
                    Object.entries(this.themeMapping).map(([key, value]) => [value, key])
                );
                this.init();
            }

            init() {
                document.getElementById('file-upload').addEventListener('change', (e) => this.handleFileUpload(e));
                document.getElementById('add-record-btn').addEventListener('click', () => this.addNewRecord());
                document.getElementById('download-btn').addEventListener('click', () => this.downloadData());
                document.getElementById('load-from-url-btn').addEventListener('click', () => this.loadFromURL());
                this.render();
            }

            showAlert(message, type = 'success') {
                const container = document.getElementById('alerts-container');
                const alert = document.createElement('div');
                alert.className = `alert alert-${type} alert-dismissible fade show`;
                alert.innerHTML = `
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                `;
                container.appendChild(alert);
                setTimeout(() => {
                    if (alert.parentNode) {
                        alert.remove();
                    }
                }, 5000);
            }

            async loadFromURL() {
                const url = 'mcc.json';
                const button = document.getElementById('load-from-url-btn');
                const originalText = button.textContent;
                
                try {
                    button.textContent = 'Loading...';
                    button.disabled = true;
                    
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const jsonData = await response.json();
                    if (jsonData.data && Array.isArray(jsonData.data)) {
                        this.data = jsonData;
                        this.render();
                        this.showAlert(`Successfully loaded ${jsonData.data.length} records from website!`);
                    } else {
                        throw new Error('Invalid JSON structure from URL');
                    }
                } catch (error) {
                    this.showAlert('Error loading data from website: ' + error.message, 'error');
                } finally {
                    button.textContent = originalText;
                    button.disabled = false;
                }
            }

            handleFileUpload(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const jsonData = JSON.parse(e.target.result);
                        if (jsonData.data && Array.isArray(jsonData.data)) {
                            this.data = jsonData;
                            this.render();
                            this.showAlert('JSON file loaded successfully!');
                        } else {
                            throw new Error('Invalid JSON structure');
                        }
                    } catch (error) {
                        this.showAlert('Error loading JSON file: ' + error.message, 'error');
                    }
                };
                reader.readAsText(file);
            }

            addNewRecord() {
                const newRecord = {
                    "last-updated": new Date().toISOString().split('T')[0],
                    "english-theme": "",
                    "french-theme": "",
                    "english-commitment": "",
                    "french-commitment": "",
                    "english-title": "",
                    "french-title": "",
                    "english-summary ": "",
                    "french-summary": "",
                    "english-progress": "To be actioned",
                    "french-progress": "À mettre en œuvre",
                    "recommendations-1": "",
                    "recommendations-2": "",
                    "recommendations-3": "",
                    "update-1-date": "",
                    "english-update-1": "",
                    "french-update-1": "",
                    "update-2-date": "",
                    "english-update-2": "",
                    "french-update-2": "",
                    "update-3-date": "",
                    "english-update-3": "",
                    "french-update-3": "",
                    "update-4-date": "",
                    "english-update-4": "",
                    "french-update-4": "",
                    "update-5-date": "",
                    "english-update-5": "",
                    "french-update-5": "",
                    "update-6-date": "",
                    "english-update-6": "",
                    "french-update-6": ""
                };
                this.data.data.push(newRecord);
                this.render();
                this.showAlert('New record added successfully!');
            }

            deleteRecord(index) {
                if (confirm('Are you sure you want to delete this record?')) {
                    this.data.data.splice(index, 1);
                    this.render();
                    this.showAlert('Record deleted successfully!');
                }
            }

            downloadData() {
                const dataStr = JSON.stringify(this.data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `rcmp-data-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                this.showAlert('Data downloaded successfully!');
            }

            updateRecord(index, field, value) {
                if (this.data.data[index]) {
                    this.data.data[index][field] = value;
                    
                    // Handle theme linking
                    if (field === 'english-theme' && this.themeMapping[value]) {
                        this.data.data[index]['french-theme'] = this.themeMapping[value];
                        const frenchSelect = document.getElementById(`french-theme-${index}`);
                        if (frenchSelect) frenchSelect.value = this.themeMapping[value];
                    } else if (field === 'french-theme' && this.reversedThemeMapping[value]) {
                        this.data.data[index]['english-theme'] = this.reversedThemeMapping[value];
                        const englishSelect = document.getElementById(`english-theme-${index}`);
                        if (englishSelect) englishSelect.value = this.reversedThemeMapping[value];
                    }
                    
                    // Handle progress linking
                    else if (field === 'english-progress') {
                        const progressMap = {
                            'To be actioned': 'À mettre en œuvre',
                            'In progress': 'En cours',
                            'Complete': 'Terminé'
                        };
                        if (progressMap[value]) {
                            this.data.data[index]['french-progress'] = progressMap[value];
                            const frenchSelect = document.getElementById(`french-progress-${index}`);
                            if (frenchSelect) frenchSelect.value = progressMap[value];
                        }
                    } else if (field === 'french-progress') {
                        const progressMap = {
                            'À mettre en œuvre': 'To be actioned',
                            'En cours': 'In progress',
                            'Terminé': 'Complete'
                        };
                        if (progressMap[value]) {
                            this.data.data[index]['english-progress'] = progressMap[value];
                            const englishSelect = document.getElementById(`english-progress-${index}`);
                            if (englishSelect) englishSelect.value = progressMap[value];
                        }
                    }
                }
            }

            getStatusClass(progress) {
                return progress && (progress.toLowerCase().includes('complete') || progress.toLowerCase().includes('terminé')) 
                    ? 'status-complete' 
                    : 'status-pending';
            }

            getThemeOptions(selectedValue, isEnglish = true) {
                const themes = isEnglish ? Object.keys(this.themeMapping) : Object.values(this.themeMapping);
                return themes.map(theme => 
                    `<option value="${theme}" ${selectedValue === theme ? 'selected' : ''}>${theme}</option>`
                ).join('');
            }

            render() {
                const container = document.getElementById('records-container');
                
                if (this.data.data.length === 0) {
                    container.innerHTML = `
                        <div class="no-records">
                            <h3>No records found</h3>
                            <p>Upload a JSON file or add a new record to get started.</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.data.data.map((record, index) => `
                    <div class="record-card">
                        <div class="record-header">
                            <div>
                                <h2 class="h4 mb-1">Record ${index + 1}${record['english-title'] ? ` - ${record['english-title']}` : ''}</h2>
                                <span class="status-badge ${this.getStatusClass(record['english-progress'])}">
                                    ${record['english-progress'] || 'Unknown Status'}
                                </span>
                                <small class="text-muted d-block mt-1">Updated: ${record['last-updated'] || 'Not set'}</small>
                            </div>
                            <button class="btn btn-danger btn-sm" onclick="editor.deleteRecord(${index})">Delete</button>
                        </div>
                        
                        <div class="record-body">
                            <div class="mb-3">
                                <label for="last-updated-${index}" class="form-label">Last updated</label>
                                <input type="date" class="form-control" id="last-updated-${index}" value="${record['last-updated'] || ''}"
                                       onchange="editor.updateRecord(${index}, 'last-updated', this.value)">
                            </div>

                            <div class="form-row mb-3">
                                <div>
                                    <label for="english-theme-${index}" class="form-label">English theme</label>
                                    <select class="form-select" id="english-theme-${index}" onchange="editor.updateRecord(${index}, 'english-theme', this.value)">
                                        <option value="">Select a theme...</option>
                                        ${this.getThemeOptions(record['english-theme'], true)}
                                    </select>
                                </div>
                                <div>
                                    <label for="french-theme-${index}" class="form-label">French theme</label>
                                    <select class="form-select" id="french-theme-${index}" onchange="editor.updateRecord(${index}, 'french-theme', this.value)">
                                        <option value="">Sélectionner un thème...</option>
                                        ${this.getThemeOptions(record['french-theme'], false)}
                                    </select>
                                </div>
                            </div>

                            <div class="form-row mb-3">
                                <div>
                                    <label for="english-title-${index}" class="form-label">English title</label>
                                    <textarea class="form-control" id="english-title-${index}" rows="3" onchange="editor.updateRecord(${index}, 'english-title', this.value)">${record['english-title'] || ''}</textarea>
                                </div>
                                <div>
                                    <label for="french-title-${index}" class="form-label">French title</label>
                                    <textarea class="form-control" id="french-title-${index}" rows="3" onchange="editor.updateRecord(${index}, 'french-title', this.value)">${record['french-title'] || ''}</textarea>
                                </div>
                            </div>

                            <div class="form-row mb-3">
                                <div>
                                    <label for="english-summary-${index}" class="form-label">English summary</label>
                                    <textarea class="form-control" id="english-summary-${index}" rows="4" onchange="editor.updateRecord(${index}, 'english-summary ', this.value)">${record['english-summary '] || ''}</textarea>
                                </div>
                                <div>
                                    <label for="french-summary-${index}" class="form-label">French summary</label>
                                    <textarea class="form-control" id="french-summary-${index}" rows="4" onchange="editor.updateRecord(${index}, 'french-summary', this.value)">${record['french-summary'] || ''}</textarea>
                                </div>
                            </div>

                            <div class="form-row mb-3">
                                <div>
                                    <label for="english-progress-${index}" class="form-label">English progress</label>
                                    <select class="form-select" id="english-progress-${index}" onchange="editor.updateRecord(${index}, 'english-progress', this.value)">
                                        <option value="To be actioned" ${record['english-progress'] === 'To be actioned' ? 'selected' : ''}>To be actioned</option>
                                        <option value="In progress" ${record['english-progress'] === 'In progress' ? 'selected' : ''}>In progress</option>
                                        <option value="Complete" ${record['english-progress'] === 'Complete' ? 'selected' : ''}>Complete</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="french-progress-${index}" class="form-label">French progress</label>
                                    <select class="form-select" id="french-progress-${index}" onchange="editor.updateRecord(${index}, 'french-progress', this.value)">
                                        <option value="À mettre en œuvre" ${record['french-progress'] === 'À mettre en œuvre' ? 'selected' : ''}>À mettre en œuvre</option>
                                        <option value="En cours" ${record['french-progress'] === 'En cours' ? 'selected' : ''}>En cours</option>
                                        <option value="Terminé" ${record['french-progress'] === 'Terminé' ? 'selected' : ''}>Terminé</option>
                                    </select>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="recommendations-${index}" class="form-label">Recommendations</label>
                                <input type="text" class="form-control" id="recommendations-${index}" value="${record['recommendations-1'] || ''}"
                                       onchange="editor.updateRecord(${index}, 'recommendations-1', this.value)">
                            </div>

                            <div class="update-section">
                                <h3 class="h5">Progress Updates</h3>
                                ${[1, 2, 3, 4, 5, 6].map(updateNum => {
                                    const hasUpdate = record[`update-${updateNum}-date`] || record[`english-update-${updateNum}`] || record[`french-update-${updateNum}`];
                                    return hasUpdate ? `
                                        <div class="update-item">
                                            <div class="d-flex justify-content-between align-items-center mb-3">
                                                <h4 class="h6 mb-0">Update ${updateNum}</h4>
                                                <button class="btn btn-outline-danger btn-sm" onclick="editor.deleteUpdate(${index}, ${updateNum})">Delete</button>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="update-${updateNum}-date-${index}" class="form-label">Date</label>
                                                <input type="date" class="form-control" id="update-${updateNum}-date-${index}" value="${record[`update-${updateNum}-date`] || ''}"
                                                       onchange="editor.updateRecord(${index}, 'update-${updateNum}-date', this.value)">
                                            </div>
                                            
                                            <div class="form-row">
                                                <div>
                                                    <label for="english-update-${updateNum}-${index}" class="form-label">English update</label>
                                                    <textarea class="form-control" id="english-update-${updateNum}-${index}" rows="4" 
                                                              onchange="editor.updateRecord(${index}, 'english-update-${updateNum}', this.value)">${record[`english-update-${updateNum}`] || ''}</textarea>
                                                </div>
                                                <div>
                                                    <label for="french-update-${updateNum}-${index}" class="form-label">French update</label>
                                                    <textarea class="form-control" id="french-update-${updateNum}-${index}" rows="4"
                                                              onchange="editor.updateRecord(${index}, 'french-update-${updateNum}', this.value)">${record[`french-update-${updateNum}`] || ''}</textarea>
                                                </div>
                                            </div>
                                        </div>
                                    ` : '';
                                }).join('')}
                                
                                <button class="btn btn-outline-secondary btn-sm" onclick="editor.addUpdate(${index})">Add Update</button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            addUpdate(recordIndex) {
                const record = this.data.data[recordIndex];
                if (!record) return;

                for (let i = 1; i <= 6; i++) {
                    if (!record[`update-${i}-date`] && !record[`english-update-${i}`] && !record[`french-update-${i}`]) {
                        record[`update-${i}-date`] = new Date().toISOString().split('T')[0];
                        record[`english-update-${i}`] = '';
                        record[`french-update-${i}`] = '';
                        this.render();
                        this.showAlert(`Update ${i} added to record ${recordIndex + 1}!`);
                        return;
                    }
                }
                this.showAlert('Maximum number of updates (6) reached for this record.', 'error');
            }

            deleteUpdate(recordIndex, updateNumber) {
                if (confirm(`Are you sure you want to delete update ${updateNumber}?`)) {
                    const record = this.data.data[recordIndex];
                    if (record) {
                        record[`update-${updateNumber}-date`] = '';
                        record[`english-update-${updateNumber}`] = '';
                        record[`french-update-${updateNumber}`] = '';
                        this.render();
                        this.showAlert(`Update ${updateNumber} deleted from record ${recordIndex + 1}!`);
                    }
                }
            }
        }

        // Initialize the editor when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            window.editor = new RCMPDataEditor();
        });
    </script>
</body>
</html>
