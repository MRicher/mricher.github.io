<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RCMP JSON Data Editor</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3a8a, #3b82f6);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            margin: 0 0 10px 0;
            font-size: 2rem;
            font-weight: 600;
        }

        .header p {
            margin: 0;
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .controls {
            padding: 20px 30px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #64748b;
            color: white;
        }

        .btn-secondary:hover {
            background: #475569;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input {
            position: absolute;
            left: -9999px;
        }

        .main-content {
            padding: 30px;
        }

        .record {
            background: #ffffff;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            margin-bottom: 30px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .record:hover {
            border-color: #3b82f6;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.1);
        }

        .record-header {
            background: #f1f5f9;
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .record-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #1e293b;
            margin: 0;
        }

        .record-meta {
            display: flex;
            gap: 15px;
            align-items: center;
            font-size: 0.9rem;
            color: #64748b;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-complete {
            background: #dcfce7;
            color: #166534;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .record-body {
            padding: 25px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #374151;
            font-size: 0.95rem;
        }

        .form-input, .form-textarea, .form-select {
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .updates-section {
            margin-top: 30px;
            padding-top: 25px;
            border-top: 2px solid #f1f5f9;
        }

        .updates-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .updates-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1e293b;
            margin: 0;
        }

        .update-item {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .update-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .update-number {
            font-weight: 600;
            color: #3b82f6;
            font-size: 1.1rem;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .alert {
            padding: 16px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .alert-success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        .alert-error {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .btn {
                justify-content: center;
            }

            .record-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            color: #64748b;
        }

        .spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid #e2e8f0;
            border-radius: 50%;
            border-top-color: #3b82f6;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>RCMP JSON Data Editor</h1>
            <p>Manage and edit RCMP commitment records with full accessibility support</p>
        </header>

        <div class="controls">
            <div class="file-input-wrapper">
                <input type="file" id="fileInput" class="file-input" accept=".json" aria-label="Upload JSON file">
                <label for="fileInput" class="btn btn-secondary">
                    üìÅ Upload JSON File
                </label>
            </div>
            <button id="addRecord" class="btn btn-primary">
                ‚ûï Add New Record
            </button>
            <button id="downloadData" class="btn btn-primary">
                ‚¨áÔ∏è Download JSON
            </button>
        </div>

        <main class="main-content">
            <div id="alerts"></div>
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>Processing data...</p>
            </div>
            <div id="recordsContainer"></div>
        </main>
    </div>

    <script>
        class RCMPDataEditor {
            constructor() {
                this.data = { data: [] };
                this.themeMapping = {
                    'Culture and accountability': 'Culture et reddition de comptes',
                    'Firearms': 'Armes √† feu',
                    'Gender-based violence and intimate partner violence': 'La violence fond√©e sur le sexe et la violence exerc√©e par les partenaires intimes',
                    'Governance': 'Gouvernance',
                    'Information sharing': 'Communication d\'information',
                    'Managing crises': 'Gestion de crises',
                    'Organizational standards': 'Normes organisationnelles',
                    'Partnerships and engagement': 'Partenariats et engagement',
                    'Resourcing and recruitment': 'Ressources et recrutement',
                    'Training': 'Formation'
                };
                this.reversedThemeMapping = Object.fromEntries(
                    Object.entries(this.themeMapping).map(([key, value]) => [value, key])
                );
                this.init();
                this.loadInitialData();
            }

            init() {
                this.bindEvents();
                this.render();
            }

            loadInitialData() {
                // Load the provided JSON data
                this.data = {
                    "data": [
                        {
                            "last-updated": "2025-03-01",
                            "english-theme": "Managing crises",
                            "french-theme": "Gestion de crises",
                            "english-commitment": "",
                            "french-commitment": "",
                            "english-title": "Explore the establishment of an RCMP capacity to support victims of mass casualty, mass violence and terrorism events",
                            "french-title": "√âtudier la mise en place d'une capacit√© de la GRC √† soutenir les victimes d'√©v√©nements de masse, de violence de masse et de terrorisme",
                            "english-summary ": "The RCMP will draft a framework to create the National Centre of Expertise on Supporting Victims of Terrorism, Mass Violence and Mass Casualty. The policy proposal will outline how the RCMP will feed into the broader initiative led jointly by Public Safety Canada with the RCMP to provide operational support from a law enforcement perspective.",
                            "french-summary": "La GRC va √©laborer un cadre pour cr√©er le Centre national d'expertise sur le soutien aux victimes du terrorisme, de la violence de masse et des pertes massives. La proposition de politique d√©crira comment la GRC contribuera √† l'initiative plus large men√©e conjointement par la S√©curit√© publique Canada et la GRC pour fournir un soutien op√©rationnel du point de vue de l'application de la loi.",
                            "english-progress": "Complete",
                            "french-progress": "Termin√©",
                            "recommendations-1": "C2, C12",
                            "recommendations-2": "",
                            "recommendations-3": "",
                            "update-1-date": "2025-03-01",
                            "english-update-1": "The proposed Framework for a National Centre of Expertise on Supporting Victims of Terrorism, Mass Violence and Mass Casualty Incidents was completed in December 2024.  Efforts are underway to determine appropriate resourcing to continue with implementation.",
                            "french-update-1": "Le cadre propos√© pour la cr√©ation d'un Centre national d'expertise sur le soutien aux victimes du terrorisme, de la violence de masse et des pertes massives a √©t√© √©tabli en d√©cembre 2024. Des travaux sont en cours pour d√©terminer les ressources n√©cessaires afin de poursuivre la mise en ≈ìuvre.",
                            "update-2-date": "",
                            "english-update-2": "",
                            "french-update-2": "",
                            "update-3-date": "",
                            "english-update-3": "",
                            "french-update-3": "",
                            "update-4-date": "",
                            "english-update-4": "",
                            "french-update-4": "",
                            "update-5-date": "",
                            "english-update-5": "",
                            "french-update-5": "",
                            "update-6-date": "",
                            "english-update-6": "",
                            "french-update-6": ""
                        },
                        {
                            "last-updated": "2024-08-01",
                            "english-theme": "Managing crises",
                            "french-theme": "Gestion de crises",
                            "english-commitment": "",
                            "french-commitment": "",
                            "english-title": "Explore integration of victim management within the command structure",
                            "french-title": "√âtudier l'int√©gration de la gestion des victimes dans la structure de commandement",
                            "english-summary ": "The RCMP will examine how to effectively integrate a Victim Management Role within command structures and ensure the position is well placed and clear within the organization. The role will support the broader approach to incident management, as will other new functions such as the dedicated hotline for families.",
                            "french-summary": "La GRC se penchera sur la fa√ßon d'int√©grer efficacement un r√¥le de gestion des victimes aux structures de commandement et s'assurera que le poste correspondant est plac√© au bon endroit et bien mis en √©vidence dans l'organisation. Ce r√¥le viendra s'inscrire dans la strat√©gie g√©n√©rale de gestion d'incidents, √† l'instar d'autres fonctions nouvelles comme la ligne d'aide pour les familles.",
                            "english-progress": "To be actioned",
                            "french-progress": "√Ä mettre en ≈ìuvre",
                            "recommendations-1": "C7",
                            "recommendations-2": "",
                            "recommendations-3": "",
                            "update-1-date": "",
                            "english-update-1": "",
                            "french-update-1": "",
                            "update-2-date": "",
                            "english-update-2": "",
                            "french-update-2": "",
                            "update-3-date": "",
                            "english-update-3": "",
                            "french-update-3": "",
                            "update-4-date": "",
                            "english-update-4": "",
                            "french-update-4": "",
                            "update-5-date": "",
                            "english-update-5": "",
                            "french-update-5": "",
                            "update-6-date": "",
                            "english-update-6": "",
                            "french-update-6": ""
                        },
                        {
                            "last-updated": "2025-06-01",
                            "english-theme": "Organizational standards",
                            "french-theme": "Normes organisationnelles",
                            "english-commitment": "",
                            "french-commitment": "",
                            "english-title": "Establish national policy for the RCMP's Community Program Officer function",
                            "french-title": "√âtablir une politique nationale pour la fonction d'agent de programme communautaire de la GRC",
                            "english-summary ": "The RCMP will establish a national policy for its Community Program Officer function to support increased divisional use of this enhanced service delivery option.",
                            "french-summary": "La GRC √©tablira une politique nationale pour sa fonction d'agent de programme communautaire afin d'appuyer l'utilisation accrue de cette option de prestation de services am√©lior√©e dans les divisions.",
                            "english-progress": "Complete",
                            "french-progress": "Termin√©",
                            "recommendations-1": "P54",
                            "recommendations-2": "",
                            "recommendations-3": "",
                            "update-1-date": "2025-03-01",
                            "english-update-1": "This policy has been created and is awaiting publication. Once published, a memo to Commanding Officers and Criminal Operations Officers will be sent to inform them of the new policy.",
                            "french-update-1": "Cette politique a √©t√© √©labor√©e et est en attente de publication. Lorsqu'elle sera publi√©e, une note de service sera envoy√©e aux commandants divisionnaires et aux officiers responsables des Enqu√™tes criminelles pour les en informer.",
                            "update-2-date": "2025-06-01",
                            "english-update-2": "The amended Community Program Officers policy was published in December 2024. The amendments support increased divisional use of this enhanced service delivery option.",
                            "french-update-2": "La politique modifi√©e sur les agents de programmes communautaires a √©t√© publi√©e en d√©cembre 2024. Les modifications apport√©es appuient le recours accru par les divisions √† cette option de prestation de services am√©lior√©s.",
                            "update-3-date": "",
                            "english-update-3": "",
                            "french-update-3": "",
                            "update-4-date": "",
                            "english-update-4": "",
                            "french-update-4": "",
                            "update-5-date": "",
                            "english-update-5": "",
                            "french-update-5": "",
                            "update-6-date": "",
                            "english-update-6": "",
                            "french-update-6": ""
                        }
                    ]
                };
                this.render();
            }

            bindEvents() {
                document.getElementById('fileInput').addEventListener('change', (e) => this.handleFileUpload(e));
                document.getElementById('addRecord').addEventListener('click', () => this.addNewRecord());
                document.getElementById('saveData').addEventListener('click', () => this.saveData());
                document.getElementById('downloadData').addEventListener('click', () => this.downloadData());
                document.getElementById('clearAll').addEventListener('click', () => this.clearAllData());
            }

            showAlert(message, type = 'success') {
                const alertsContainer = document.getElementById('alerts');
                const alert = document.createElement('div');
                alert.className = `alert alert-${type}`;
                alert.textContent = message;
                alert.setAttribute('role', 'alert');
                alert.setAttribute('aria-live', 'polite');
                
                alertsContainer.appendChild(alert);
                
                setTimeout(() => {
                    alert.remove();
                }, 5000);
            }

            showLoading() {
                document.getElementById('loading').style.display = 'block';
            }

            hideLoading() {
                document.getElementById('loading').style.display = 'none';
            }

            handleFileUpload(event) {
                const file = event.target.files[0];
                if (!file) return;

                this.showLoading();
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const jsonData = JSON.parse(e.target.result);
                        if (jsonData.data && Array.isArray(jsonData.data)) {
                            this.data = jsonData;
                            this.render();
                            this.showAlert('JSON file loaded successfully!');
                        } else {
                            throw new Error('Invalid JSON structure');
                        }
                    } catch (error) {
                        this.showAlert('Error loading JSON file: ' + error.message, 'error');
                    } finally {
                        this.hideLoading();
                    }
                };
                reader.readAsText(file);
            }

            addNewRecord() {
                const newRecord = this.createEmptyRecord();
                this.data.data.push(newRecord);
                this.render();
                this.showAlert('New record added successfully!');
                
                // Focus on the new record's first input
                setTimeout(() => {
                    const newRecordElement = document.querySelector(`#record-${this.data.data.length - 1} input`);
                    if (newRecordElement) {
                        newRecordElement.focus();
                    }
                }, 100);
            }

            createEmptyRecord() {
                return {
                    "last-updated": new Date().toISOString().split('T')[0],
                    "english-theme": "",
                    "french-theme": "",
                    "english-commitment": "",
                    "french-commitment": "",
                    "english-title": "",
                    "french-title": "",
                    "english-summary ": "",
                    "french-summary": "",
                    "english-progress": "To be actioned",
                    "french-progress": "√Ä mettre en ≈ìuvre",
                    "recommendations-1": "",
                    "recommendations-2": "",
                    "recommendations-3": "",
                    "update-1-date": "",
                    "english-update-1": "",
                    "french-update-1": "",
                    "update-2-date": "",
                    "english-update-2": "",
                    "french-update-2": "",
                    "update-3-date": "",
                    "english-update-3": "",
                    "french-update-3": "",
                    "update-4-date": "",
                    "english-update-4": "",
                    "french-update-4": "",
                    "update-5-date": "",
                    "english-update-5": "",
                    "french-update-5": "",
                    "update-6-date": "",
                    "english-update-6": "",
                    "french-update-6": ""
                };
            }

            deleteRecord(index) {
                if (confirm('Are you sure you want to delete this record? This action cannot be undone.')) {
                    this.data.data.splice(index, 1);
                    this.render();
                    this.showAlert('Record deleted successfully!');
                }
            }

            saveData() {
                // Simulate saving (in a real app, this would send to a server)
                this.showAlert('Data saved successfully!');
            }

            downloadData() {
                const dataStr = JSON.stringify(this.data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `rcmp-data-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                this.showAlert('Data downloaded successfully!');
            }

            clearAllData() {
                if (confirm('Are you sure you want to clear all data? This action cannot be undone.')) {
                    this.data = { data: [] };
                    this.render();
                    this.showAlert('All data cleared successfully!');
                }
            }

            updateRecord(index, field, value) {
                if (this.data.data[index]) {
                    this.data.data[index][field] = value;
                    
                    // Handle theme linking
                    if (field === 'english-theme' && this.themeMapping[value]) {
                        this.data.data[index]['french-theme'] = this.themeMapping[value];
                        // Update the French theme dropdown
                        const frenchSelect = document.getElementById(`french-theme-${index}`);
                        if (frenchSelect) {
                            frenchSelect.value = this.themeMapping[value];
                        }
                    } else if (field === 'french-theme' && this.reversedThemeMapping[value]) {
                        this.data.data[index]['english-theme'] = this.reversedThemeMapping[value];
                        // Update the English theme dropdown
                        const englishSelect = document.getElementById(`english-theme-${index}`);
                        if (englishSelect) {
                            englishSelect.value = this.reversedThemeMapping[value];
                        }
                    }
                }
            }

            getStatusClass(progress) {
                return progress.toLowerCase().includes('complete') || progress.toLowerCase().includes('termin√©') 
                    ? 'status-complete' 
                    : 'status-pending';
            }

            getThemeOptions(selectedValue, isEnglish = true) {
                const themes = isEnglish ? Object.keys(this.themeMapping) : Object.values(this.themeMapping);
                return themes.map(theme => 
                    `<option value="${theme}" ${selectedValue === theme ? 'selected' : ''}>${theme}</option>`
                ).join('');
            }

            render() {
                const container = document.getElementById('recordsContainer');
                
                if (this.data.data.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 60px 20px; color: #64748b;">
                            <h3>No records found</h3>
                            <p>Upload a JSON file or add a new record to get started.</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.data.data.map((record, index) => `
                    <div class="record" id="record-${index}">
                        <div class="record-header">
                            <h2 class="record-title">Record ${index + 1}</h2>
                            <div class="record-meta">
                                <span class="status-badge ${this.getStatusClass(record['english-progress'])}">
                                    ${record['english-progress'] || 'Unknown Status'}
                                </span>
                                <span>Updated: ${record['last-updated'] || 'Not set'}</span>
                                <button class="btn btn-danger" onclick="editor.deleteRecord(${index})" 
                                        aria-label="Delete record ${index + 1}">
                                    üóëÔ∏è Delete
                                </button>
                            </div>
                        </div>
                        <div class="record-body">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label" for="last-updated-${index}">Last Updated</label>
                                    <input type="date" id="last-updated-${index}" class="form-input" 
                                           value="${record['last-updated'] || ''}"
                                           onchange="editor.updateRecord(${index}, 'last-updated', this.value)"
                                           aria-describedby="last-updated-${index}-desc">
                                    <div id="last-updated-${index}-desc" class="sr-only">Date when this record was last updated</div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="english-theme-${index}">English Theme</label>
                                    <select id="english-theme-${index}" class="form-select" 
                                            onchange="editor.updateRecord(${index}, 'english-theme', this.value)"
                                            aria-describedby="english-theme-${index}-desc">
                                        <option value="">Select a theme...</option>
                                        ${this.getThemeOptions(record['english-theme'], true)}
                                    </select>
                                    <div id="english-theme-${index}-desc" class="sr-only">Theme or category in English</div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="french-theme-${index}">French Theme</label>
                                    <select id="french-theme-${index}" class="form-select" 
                                            onchange="editor.updateRecord(${index}, 'french-theme', this.value)"
                                            aria-describedby="french-theme-${index}-desc">
                                        <option value="">S√©lectionner un th√®me...</option>
                                        ${this.getThemeOptions(record['french-theme'], false)}
                                    </select>
                                    <div id="french-theme-${index}-desc" class="sr-only">Theme or category in French</div>
                                </div>
                            </div>

                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label" for="english-title-${index}">English Title</label>
                                    <textarea id="english-title-${index}" class="form-textarea" 
                                              onchange="editor.updateRecord(${index}, 'english-title', this.value)"
                                              aria-describedby="english-title-${index}-desc">${record['english-title'] || ''}</textarea>
                                    <div id="english-title-${index}-desc" class="sr-only">Title of the commitment in English</div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="french-title-${index}">French Title</label>
                                    <textarea id="french-title-${index}" class="form-textarea" 
                                              onchange="editor.updateRecord(${index}, 'french-title', this.value)"
                                              aria-describedby="french-title-${index}-desc">${record['french-title'] || ''}</textarea>
                                    <div id="french-title-${index}-desc" class="sr-only">Title of the commitment in French</div>
                                </div>
                            </div>

                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label" for="english-summary-${index}">English Summary</label>
                                    <textarea id="english-summary-${index}" class="form-textarea" 
                                              onchange="editor.updateRecord(${index}, 'english-summary ', this.value)"
                                              aria-describedby="english-summary-${index}-desc">${record['english-summary '] || ''}</textarea>
                                    <div id="english-summary-${index}-desc" class="sr-only">Summary of the commitment in English</div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="french-summary-${index}">French Summary</label>
                                    <textarea id="french-summary-${index}" class="form-textarea" 
                                              onchange="editor.updateRecord(${index}, 'french-summary', this.value)"
                                              aria-describedby="french-summary-${index}-desc">${record['french-summary'] || ''}</textarea>
                                    <div id="french-summary-${index}-desc" class="sr-only">Summary of the commitment in French</div>
                                </div>
                            </div>

                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label" for="english-progress-${index}">English Progress</label>
                                    <select id="english-progress-${index}" class="form-select" 
                                            onchange="editor.updateRecord(${index}, 'english-progress', this.value)"
                                            aria-describedby="english-progress-${index}-desc">
                                        <option value="To be actioned" ${record['english-progress'] === 'To be actioned' ? 'selected' : ''}>To be actioned</option>
                                        <option value="In progress" ${record['english-progress'] === 'In progress' ? 'selected' : ''}>In progress</option>
                                        <option value="Complete" ${record['english-progress'] === 'Complete' ? 'selected' : ''}>Complete</option>
                                    </select>
                                    <div id="english-progress-${index}-desc" class="sr-only">Current progress status in English</div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="french-progress-${index}">French Progress</label>
                                    <select id="french-progress-${index}" class="form-select" 
                                            onchange="editor.updateRecord(${index}, 'french-progress', this.value)"
                                            aria-describedby="french-progress-${index}-desc">
                                        <option value="√Ä mettre en ≈ìuvre" ${record['french-progress'] === '√Ä mettre en ≈ìuvre' ? 'selected' : ''}>√Ä mettre en ≈ìuvre</option>
                                        <option value="En cours" ${record['french-progress'] === 'En cours' ? 'selected' : ''}>En cours</option>
                                        <option value="Termin√©" ${record['french-progress'] === 'Termin√©' ? 'selected' : ''}>Termin√©</option>
                                    </select>
                                    <div id="french-progress-${index}-desc" class="sr-only">Current progress status in French</div>
                                </div>
                            </div>

                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label" for="recommendations-1-${index}">Recommendations 1</label>
                                    <input type="text" id="recommendations-1-${index}" class="form-input" 
                                           value="${record['recommendations-1'] || ''}"
                                           onchange="editor.updateRecord(${index}, 'recommendations-1', this.value)"
                                           aria-describedby="recommendations-1-${index}-desc">
                                    <div id="recommendations-1-${index}-desc" class="sr-only">First set of recommendation codes</div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="recommendations-2-${index}">Recommendations 2</label>
                                    <input type="text" id="recommendations-2-${index}" class="form-input" 
                                           value="${record['recommendations-2'] || ''}"
                                           onchange="editor.updateRecord(${index}, 'recommendations-2', this.value)"
                                           aria-describedby="recommendations-2-${index}-desc">
                                    <div id="recommendations-2-${index}-desc" class="sr-only">Second set of recommendation codes</div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="recommendations-3-${index}">Recommendations 3</label>
                                    <input type="text" id="recommendations-3-${index}" class="form-input" 
                                           value="${record['recommendations-3'] || ''}"
                                           onchange="editor.updateRecord(${index}, 'recommendations-3', this.value)"
                                           aria-describedby="recommendations-3-${index}-desc">
                                    <div id="recommendations-3-${index}-desc" class="sr-only">Third set of recommendation codes</div>
                                </div>
                            </div>

                            <div class="updates-section">
                                <div class="updates-header">
                                    <h3 class="updates-title">Progress Updates</h3>
                                </div>
                                
                                ${[1, 2, 3, 4, 5, 6].map(updateNum => {
                                    const hasUpdate = record[`update-${updateNum}-date`] || record[`english-update-${updateNum}`] || record[`french-update-${updateNum}`];
                                    return hasUpdate ? `
                                        <div class="update-item">
                                            <div class="update-header">
                                                <span class="update-number">Update ${updateNum}</span>
                                            </div>
                                            <div class="form-grid">
                                                <div class="form-group">
                                                    <label class="form-label" for="update-${updateNum}-date-${index}">Update ${updateNum} Date</label>
                                                    <input type="date" id="update-${updateNum}-date-${index}" class="form-input" 
                                                           value="${record[`update-${updateNum}-date`] || ''}"
                                                           onchange="editor.updateRecord(${index}, 'update-${updateNum}-date', this.value)"
                                                           aria-describedby="update-${updateNum}-date-${index}-desc">
                                                    <div id="update-${updateNum}-date-${index}-desc" class="sr-only">Date of update ${updateNum}</div>
                                                </div>
                                            </div>
                                            <div class="form-grid">
                                                <div class="form-group">
                                                    <label class="form-label" for="english-update-${updateNum}-${index}">English Update ${updateNum}</label>
                                                    <textarea id="english-update-${updateNum}-${index}" class="form-textarea" 
                                                              onchange="editor.updateRecord(${index}, 'english-update-${updateNum}', this.value)"
                                                              aria-describedby="english-update-${updateNum}-${index}-desc">${record[`english-update-${updateNum}`] || ''}</textarea>
                                                    <div id="english-update-${updateNum}-${index}-desc" class="sr-only">Update ${updateNum} text in English</div>
                                                </div>
                                                
                                                <div class="form-group">
                                                    <label class="form-label" for="french-update-${updateNum}-${index}">French Update ${updateNum}</label>
                                                    <textarea id="french-update-${updateNum}-${index}" class="form-textarea" 
                                                              onchange="editor.updateRecord(${index}, 'french-update-${updateNum}', this.value)"
                                                              aria-describedby="french-update-${updateNum}-${index}-desc">${record[`french-update-${updateNum}`] || ''}</textarea>
                                                    <div id="french-update-${updateNum}-${index}-desc" class="sr-only">Update ${updateNum} text in French</div>
                                                </div>
                                            </div>
                                        </div>
                                    ` : '';
                                }).join('')}
                                
                                <button class="btn btn-secondary" onclick="editor.addUpdate(${index})" 
                                        aria-label="Add new update to record ${index + 1}">
                                    ‚ûï Add Update
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            addUpdate(recordIndex) {
                const record = this.data.data[recordIndex];
                if (!record) return;

                // Find the next available update slot
                for (let i = 1; i <= 6; i++) {
                    if (!record[`update-${i}-date`] && !record[`english-update-${i}`] && !record[`french-update-${i}`]) {
                        record[`update-${i}-date`] = new Date().toISOString().split('T')[0];
                        record[`english-update-${i}`] = '';
                        record[`french-update-${i}`] = '';
                        this.render();
                        this.showAlert(`Update ${i} added to record ${recordIndex + 1}!`);
                        
                        // Focus on the new update's date field
                        setTimeout(() => {
                            const newUpdateElement = document.getElementById(`update-${i}-date-${recordIndex}`);
                            if (newUpdateElement) {
                                newUpdateElement.focus();
                            }
                        }, 100);
                        return;
                    }
                }
                
                this.showAlert('Maximum number of updates (6) reached for this record.', 'error');
            }
        }

        // Initialize the editor
        const editor = new RCMPDataEditor();

        // Add keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case 's':
                        e.preventDefault();
                        editor.saveData();
                        break;
                    case 'n':
                        e.preventDefault();
                        editor.addNewRecord();
                        break;
                    case 'd':
                        e.preventDefault();
                        editor.downloadData();
                        break;
                }
            }
        });

        // Add form validation
        document.addEventListener('input', (e) => {
            if (e.target.classList.contains('form-input') || e.target.classList.contains('form-textarea')) {
                e.target.classList.remove('error');
                if (e.target.value.trim() === '' && e.target.hasAttribute('required')) {
                    e.target.classList.add('error');
                }
            }
        });

        // Announce page load for screen readers
        document.addEventListener('DOMContentLoaded', () => {
            const announcement = document.createElement('div');
            announcement.setAttribute('aria-live', 'polite');
            announcement.setAttribute('aria-atomic', 'true');
            announcement.className = 'sr-only';
            announcement.textContent = 'RCMP JSON Data Editor loaded successfully. Use Tab to navigate through the form controls.';
            document.body.appendChild(announcement);
            
            setTimeout(() => {
                announcement.remove();
            }, 3000);
        });
    </script>
</body>
</html>
