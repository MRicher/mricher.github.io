<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location Distance Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .location-item {
            margin: 10px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
        .distance {
            font-weight: bold;
            color: #007bff;
        }
        .closest {
            border-left-color: #28a745;
            background-color: #d4edda;
        }
        dl {
            margin: 10px 0;
        }
        dt {
            font-weight: bold;
            margin-bottom: 5px;
        }
        dd {
            margin: 0 0 10px 0;
        }
        .user-location {
            background: #fff3cd;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Location Distance Calculator</h1>
        
        <button id="getLocationBtn">Get My Location & Calculate Distances</button>
        
        <div id="status"></div>
        
        <div id="userLocation"></div>
        
        <div id="results"></div>
        
        <!-- Sample location data -->
        <div id="locations" style="display: none;">
            <dl>
                <dt>Location</dt>
                <dd>
                    <a href="https://www.google.ca/maps?q=46.35234020362602,-62.23930930390567&hl=en-CA" target="_blank">198 Main Street<br> Souris, Prince Edward Island</a>
                </dd>
            </dl>
            <dl>
                <dt>Location</dt>
                <dd>
                    <a href="https://www.google.ca/maps?q=46.2382,-63.1311&hl=en-CA" target="_blank">123 University Ave<br> Charlottetown, Prince Edward Island</a>
                </dd>
            </dl>
            <dl>
                <dt>Location</dt>
                <dd>
                    <a href="https://www.google.ca/maps?q=46.4047,-63.2755&hl=en-CA" target="_blank">456 Water Street<br> Summerside, Prince Edward Island</a>
                </dd>
            </dl>
        </div>
    </div>

    <script>
        let userLocation = null;
        
        // Function to calculate distance between two points using Haversine formula
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Earth's radius in kilometers
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }
        
        // Function to extract coordinates from Google Maps URL
        function extractCoordinates(url) {
            const match = url.match(/q=([+-]?\d+\.?\d*),([+-]?\d+\.?\d*)/);
            if (match) {
                return {
                    lat: parseFloat(match[1]),
                    lng: parseFloat(match[2])
                };
            }
            return null;
        }
        
        // Function to get all location data from the page
        function getLocationData() {
            const locations = [];
            const dls = document.querySelectorAll('#locations dl');
            
            dls.forEach(dl => {
                const link = dl.querySelector('a[href*="google.ca/maps"]');
                if (link) {
                    const coords = extractCoordinates(link.href);
                    if (coords) {
                        const address = link.innerHTML.replace('<br>', ', ');
                        locations.push({
                            address: address,
                            lat: coords.lat,
                            lng: coords.lng,
                            url: link.href
                        });
                    }
                }
            });
            
            return locations;
        }
        
        // Function to display status messages
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        // Function to display user location
        function displayUserLocation(lat, lng) {
            const userLocationDiv = document.getElementById('userLocation');
            userLocationDiv.innerHTML = `
                <div class="user-location">
                    <strong>Your Location:</strong><br>
                    Latitude: ${lat.toFixed(6)}<br>
                    Longitude: ${lng.toFixed(6)}
                </div>
            `;
        }
        
        // Function to display results
        function displayResults(locations) {
            const resultsDiv = document.getElementById('results');
            
            if (locations.length === 0) {
                resultsDiv.innerHTML = '<p>No locations found on this page.</p>';
                return;
            }
            
            // Sort by distance
            locations.sort((a, b) => a.distance - b.distance);
            
            let html = '<h3>Locations sorted by distance:</h3>';
            
            locations.forEach((location, index) => {
                const isClosest = index === 0;
                html += `
                    <div class="location-item ${isClosest ? 'closest' : ''}">
                        <div class="distance">
                            ${isClosest ? 'ðŸŽ¯ CLOSEST: ' : ''}
                            ${location.distance.toFixed(2)} km away
                        </div>
                        <div><strong>Address:</strong> ${location.address}</div>
                        <div><strong>Coordinates:</strong> ${location.lat.toFixed(6)}, ${location.lng.toFixed(6)}</div>
                        <div><a href="${location.url}" target="_blank">View on Google Maps</a></div>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
        }
        
        // Function to get user location and calculate distances
        function getUserLocationAndCalculate() {
            const btn = document.getElementById('getLocationBtn');
            btn.disabled = true;
            btn.textContent = 'Getting location...';
            
            showStatus('Requesting your location...', 'info');
            
            if (!navigator.geolocation) {
                showStatus('Geolocation is not supported by this browser.', 'error');
                btn.disabled = false;
                btn.textContent = 'Get My Location & Calculate Distances';
                return;
            }
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    userLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    
                    showStatus('Location found! Calculating distances...', 'success');
                    displayUserLocation(userLocation.lat, userLocation.lng);
                    
                    // Get all locations from the page
                    const locations = getLocationData();
                    
                    // Calculate distances
                    locations.forEach(location => {
                        location.distance = calculateDistance(
                            userLocation.lat,
                            userLocation.lng,
                            location.lat,
                            location.lng
                        );
                    });
                    
                    displayResults(locations);
                    
                    btn.disabled = false;
                    btn.textContent = 'Recalculate Distances';
                },
                (error) => {
                    let errorMessage = 'Unable to get your location. ';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage += 'Location access denied by user.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage += 'Location information unavailable.';
                            break;
                        case error.TIMEOUT:
                            errorMessage += 'Location request timed out.';
                            break;
                        default:
                            errorMessage += 'Unknown error occurred.';
                    }
                    
                    showStatus(errorMessage, 'error');
                    btn.disabled = false;
                    btn.textContent = 'Get My Location & Calculate Distances';
                }
            );
        }
        
        // Event listener
        document.getElementById('getLocationBtn').addEventListener('click', getUserLocationAndCalculate);
        
        // You can also call this function directly if you want to auto-run it
        // getUserLocationAndCalculate();
    </script>
</body>
</html>
