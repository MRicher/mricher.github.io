const APP_VERSION="1.0.1",VERSION_STRING="Version 1.0.1";document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("version-info");e&&(e.textContent=VERSION_STRING)}));class CookieManager{static setCookie(e,t,n=365){const a=new Date;a.setTime(a.getTime()+24*n*60*60*1e3),document.cookie=`${e}=${t}; expires=${a.toUTCString()}; path=/; SameSite=Strict`}static getCookie(e){const t=document.cookie.split(";");for(let n of t){const[t,a]=n.trim().split("=");if(t===e)return a}return null}static deleteCookie(e){document.cookie=`${e}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`}}class ThemeManager{constructor(){this.currentTheme=this.getStoredTheme()||"light",this.init()}getStoredTheme(){return CookieManager.getCookie("preferred_theme")||localStorage.getItem("theme")||"light"}saveTheme(e){CookieManager.setCookie("preferred_theme",e),localStorage.setItem("theme",e)}init(){this.applyTheme(this.currentTheme),this.setupThemeToggle()}setupThemeToggle(){const e=document.getElementById("theme-toggle");e&&e.addEventListener("click",(()=>this.toggleTheme()))}toggleTheme(){this.currentTheme="light"===this.currentTheme?"dark":"light",this.applyTheme(this.currentTheme),this.saveTheme(this.currentTheme),this.announceThemeChange()}applyTheme(e){document.documentElement.setAttribute("data-theme",e),document.documentElement.setAttribute("data-bs-theme",e),this.updateThemeButton(e)}updateThemeButton(e){const t=document.getElementById("theme-toggle"),n=document.getElementById("theme-text");if(t&&n){const a=document.documentElement.lang?.split("-")[0]||"en";if("dark"===e){const e="fr"===a?"Mode clair":"Light mode";n.textContent=e,t.setAttribute("aria-label","Switch to light mode")}else{const e="fr"===a?"Mode sombre":"Dark mode";n.textContent=e,t.setAttribute("aria-label","Switch to dark mode")}}}announceThemeChange(){const e=document.createElement("div");e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),e.className="sr-only";const t="dark"===this.currentTheme?"Dark theme activated":"Light theme activated";e.textContent=t,document.body.appendChild(e),setTimeout((()=>{document.body.contains(e)&&document.body.removeChild(e)}),1e3)}}class LanguageSwitcher{constructor(){this.currentLang=this.getPreferredLanguage(),this.init()}getPreferredLanguage(){const e=this.getLanguageFromUrl(),t=CookieManager.getCookie("preferred_language"),n=document.documentElement.lang;return e||t||n||"en-CA"}getLanguageFromUrl(){const e=new URLSearchParams(window.location.search).get("lang");return"English"===e||"en"===e||"en-CA"===e?"en-CA":"Français"===e||"fr"===e||"fr-CA"===e?"fr-CA":null}saveLanguage(e){CookieManager.setCookie("preferred_language",e)}updateUrl(e){const t=new URL(window.location),n=e.split("-")[0];t.searchParams.set("lang",n),window.history.replaceState({},"",t)}init(){document.querySelectorAll("[data-lang]").forEach((e=>{e.addEventListener("click",(e=>{const t=e.currentTarget.getAttribute("data-lang");this.switchLanguage(t)}))})),this.switchLanguage(this.currentLang)}switchLanguage(e){this.currentLang=e,document.documentElement.lang=e,this.saveLanguage(e),this.updateUrl(e);document.querySelectorAll("[data-en][data-fr]").forEach((t=>{const n=e.split("-")[0],a=t.getAttribute(`data-${n}`);a&&this.updateElementContent(t,a)})),this.updateLanguageButtons(),this.announceLanguageChange(e),window.themeManager&&window.themeManager.updateThemeButton(window.themeManager.currentTheme),window.editor&&"function"==typeof window.editor.updateCalendarLanguage&&setTimeout((()=>window.editor.updateCalendarLanguage()),100),document.dispatchEvent(new CustomEvent("languageChanged",{detail:{language:e}}))}updateElementContent(e,t){"INPUT"===e.tagName||"TEXTAREA"===e.tagName?e.placeholder=t:"IMG"===e.tagName?e.alt=t:e.hasAttribute("content")?e.setAttribute("content",t):e.hasAttribute("aria-label")&&e.hasAttribute("title")?(e.setAttribute("aria-label",t),e.title=t):e.hasAttribute("aria-label")?e.setAttribute("aria-label",t):e.hasAttribute("title")?e.title=t:e.innerHTML=t}updateLanguageButtons(){const e=document.getElementById("lang-fr-btn"),t=document.getElementById("lang-en-btn");"en-CA"===this.currentLang?(e&&(e.style.display="block"),t&&(t.style.display="none")):(e&&(e.style.display="none"),t&&(t.style.display="block"))}announceLanguageChange(e){const t=document.createElement("div");t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.className="sr-only";const n="en-CA"===e?"Language switched to English":"Langue changée en français";t.textContent=n,document.body.appendChild(t),setTimeout((()=>{document.body.contains(t)&&document.body.removeChild(t)}),1e3)}}class BackToTopButton{constructor(){this.button=document.getElementById("backToTop"),this.scrollThreshold=300,this.init()}init(){if(!this.button)return;let e;window.addEventListener("scroll",(()=>{e&&clearTimeout(e),e=setTimeout((()=>this.handleScroll()),10)})),this.button.addEventListener("click",(()=>this.scrollToTop())),this.button.addEventListener("keydown",(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.scrollToTop())})),this.handleScroll()}handleScroll(){(window.pageYOffset||document.documentElement.scrollTop)>this.scrollThreshold?this.button.classList.add("visible"):this.button.classList.remove("visible")}scrollToTop(){window.scrollTo({top:0,behavior:"smooth"}),setTimeout((()=>{const e=document.querySelector("h1, .main-heading, #main-content");e&&-1===e.tabIndex&&(e.tabIndex=-1,e.focus())}),500)}}class UIUtils{static handleEscapeKey(){document.addEventListener("keydown",(e=>{if("Escape"===e.key){if(document.querySelector(".navbar-collapse.show")){const e=document.querySelector(".navbar-toggler");e&&(e.click(),e.focus())}}}))}static setupMobileMenuFocus(){const e=document.querySelector(".navbar-toggler");e&&e.addEventListener("click",(()=>{setTimeout((()=>{if("true"===e.getAttribute("aria-expanded")){const e=document.querySelector(".navbar-nav .nav-link");e&&e.focus()}}),100)}))}}document.addEventListener("DOMContentLoaded",(()=>{window.themeManager=new ThemeManager,window.languageSwitcher=new LanguageSwitcher,window.backToTopButton=new BackToTopButton,UIUtils.handleEscapeKey(),UIUtils.setupMobileMenuFocus(),console.log("Global preferences loaded:",{theme:CookieManager.getCookie("preferred_theme"),language:CookieManager.getCookie("preferred_language")})}));