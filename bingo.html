<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ¦œ Parrot Bingo Caller - Multi-Card System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #4CAF50, #2E7D32, #1B5E20);
            color: #333;
            min-height: 100vh;
            padding: 1rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        /* Header */
        .header {
            background: linear-gradient(45deg, #FF6B35, #F7931E, #FFD23F);
            padding: 2rem 1rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header h1 {
            font-size: 2.5rem;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 0.5rem;
        }

        .header .subtitle {
            font-size: 1.2rem;
            color: #fff;
            opacity: 0.9;
        }

        /* Parrot SVG decoration */
        .parrot-decoration {
            position: absolute;
            top: 10px;
            right: 20px;
            width: 60px;
            height: 60px;
            opacity: 0.8;
        }

        /* Card links section */
        .card-links {
            background: linear-gradient(135deg, #E8F5E8, #F1F8E9);
            padding: 1rem;
            border-bottom: 2px solid #4CAF50;
        }

        .card-links h3 {
            text-align: center;
            color: #2E7D32;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .card-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .card-link {
            background: linear-gradient(45deg, #4CAF50, #66BB6A);
            color: white;
            text-decoration: none;
            padding: 0.8rem 1.5rem;
            border-radius: 10px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .card-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        /* Winner alerts */
        .winner-alerts {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            padding: 1rem;
            margin: 1rem;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
            display: none;
        }

        .winner-alerts.show {
            display: block;
            animation: winnerPulse 2s infinite alternate;
        }

        @keyframes winnerPulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.02); }
        }

        .winner-title {
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 1rem;
        }

        .winner-list {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .winner-card {
            background: white;
            padding: 0.8rem 1.2rem;
            border-radius: 10px;
            font-weight: bold;
            color: #2E7D32;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        /* Main content area */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 2rem;
            padding: 2rem;
        }

        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        /* Current number display */
        .current-number-section {
            text-align: center;
            background: linear-gradient(135deg, #E8F5E8, #F1F8E9);
            border-radius: 15px;
            padding: 2rem;
            border: 3px solid #4CAF50;
            position: relative;
        }

        .current-number {
            font-size: 4rem;
            font-weight: bold;
            color: #2E7D32;
            margin: 1rem 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .current-letter {
            font-size: 1.5rem;
            color: #FF6B35;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .squawk-bubble {
            position: absolute;
            top: -15px;
            right: 20px;
            background: #FFD23F;
            border-radius: 20px;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            font-weight: bold;
            color: #333;
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .squawk-bubble.show {
            opacity: 1;
            transform: scale(1);
        }

        .squawk-bubble::before {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 20px;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid #FFD23F;
        }

        /* Buttons */
        .button-section {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 1rem 2rem;
            font-size: 1.2rem;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            outline: none;
            position: relative;
        }

        .btn:focus {
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.5);
        }

        .btn-primary {
            background: linear-gradient(45deg, #4CAF50, #66BB6A);
            color: white;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #FF6B35, #F7931E);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
        }

        .btn-tertiary {
            background: linear-gradient(45deg, #9C27B0, #BA68C8);
            color: white;
            box-shadow: 0 4px 15px rgba(156, 39, 176, 0.3);
            font-size: 1rem;
            padding: 0.8rem 1.5rem;
        }

        .btn-tertiary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(156, 39, 176, 0.4);
        }

        /* Counters */
        .counters {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin: 1rem 0;
        }

        .counter {
            background: white;
            padding: 1rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            border: 2px solid #4CAF50;
        }

        .counter-number {
            font-size: 2rem;
            font-weight: bold;
            color: #2E7D32;
        }

        .counter-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 0.5rem;
        }

        /* BINGO Grid */
        .bingo-grid {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .grid-header {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .letter-header {
            background: linear-gradient(45deg, #FF6B35, #F7931E);
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            padding: 0.8rem;
            border-radius: 8px;
        }

        .numbers-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.3rem;
        }

        .number-cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            border-radius: 5px;
            transition: all 0.3s ease;
            background: #f0f0f0;
            color: #333;
            border: 1px solid #ddd;
        }

        .number-cell.called {
            background: linear-gradient(45deg, #4CAF50, #66BB6A);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.4);
        }

        .number-cell.current {
            background: linear-gradient(45deg, #FFD23F, #FFA726);
            color: #333;
            animation: pulse 1s infinite alternate;
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(255, 193, 7, 0.6);
        }

        @keyframes pulse {
            0% { transform: scale(1.1); }
            100% { transform: scale(1.15); }
        }

        /* Right panel - History */
        .right-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 1.5rem;
            border: 2px solid #e9ecef;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .history-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #2E7D32;
        }

        .history-list {
            max-height: 400px;
            overflow-y: auto;
            background: white;
            border-radius: 10px;
            padding: 1rem;
            border: 1px solid #ddd;
        }

        .history-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(90deg, #E8F5E8, #F1F8E9);
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }

        .history-number {
            font-weight: bold;
            font-size: 1.1rem;
            color: #2E7D32;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .modal h3 {
            margin-bottom: 1rem;
            color: #2E7D32;
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1.5rem;
        }

        /* Game complete message */
        .game-complete {
            text-align: center;
            background: linear-gradient(135deg, #FFD23F, #FFA726);
            padding: 2rem;
            border-radius: 15px;
            margin: 1rem 0;
            box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);
        }

        .game-complete h2 {
            color: #333;
            margin-bottom: 1rem;
        }

        /* Screen reader only */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 1rem;
                padding: 1rem;
            }

            .header h1 {
                font-size: 2rem;
            }

            .current-number {
                font-size: 3rem;
            }

            .counters {
                flex-direction: column;
                gap: 1rem;
                align-items: center;
            }

            .counter {
                width: 200px;
            }

            .button-section {
                flex-direction: column;
                align-items: center;
            }

            .btn {
                width: 100%;
                max-width: 300px;
            }

            .numbers-grid {
                gap: 0.2rem;
            }

            .number-cell {
                font-size: 0.8rem;
            }

            .parrot-decoration {
                display: none;
            }

            .card-buttons {
                justify-content: center;
            }

            .card-link {
                padding: 0.6rem 1rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ðŸ¦œ Parrot Bingo Caller</h1>
            <p class="subtitle">Multi-Card Bingo System - Squawk your way to victory!</p>
            <svg class="parrot-decoration" viewBox="0 0 100 100">
                <circle cx="30" cy="30" r="20" fill="#FF6B35"/>
                <circle cx="35" cy="25" r="3" fill="white"/>
                <circle cx="37" cy="25" r="1" fill="black"/>
                <path d="M45 30 L55 25 L50 35 Z" fill="#FFD23F"/>
                <ellipse cx="30" cy="50" rx="15" ry="25" fill="#4CAF50"/>
                <path d="M15 70 Q25 65 35 70 Q25 75 15 70" fill="#2E7D32"/>
                <path d="M25 75 Q30 80 35 75" fill="#2E7D32"/>
            </svg>
        </header>

        <!-- Card Links Section -->
        <div class="card-links">
            <h3>ðŸŽ¯ Open Bingo Cards (Right-click to open in new tab)</h3>
            <div class="card-buttons">
                <a href="parrt.html" target="_blank" class="card-link">Card PARRT</a>
                <a href="sqawk.html" target="_blank" class="card-link">Card SQAWK</a>
                <a href="bingo-card-WINGS.html" target="_blank" class="card-link">Card WINGS</a>
                <a href="bingo-card-FLYER.html" target="_blank" class="card-link">Card FLYER</a>
                <a href="bingo-card-BIRDY.html" target="_blank" class="card-link">Card BIRDY</a>
            </div>
        </div>

        <!-- Winner Alerts -->
        <div class="winner-alerts" id="winnerAlerts">
            <div class="winner-title">ðŸŽ‰ BINGO WINNERS! ðŸŽ‰</div>
            <div class="winner-list" id="winnerList"></div>
        </div>

        <main class="main-content">
            <div class="left-panel">
                <section class="current-number-section" aria-live="polite" aria-atomic="true">
                    <div class="squawk-bubble" id="squawkBubble">Squawk!</div>
                    <div class="current-letter" id="currentLetter">Ready to play!</div>
                    <div class="current-number" id="currentNumber">--</div>
                    <div id="announcer" class="sr-only" aria-live="assertive" aria-atomic="true"></div>
                </section>

                <div class="button-section">
                    <button class="btn btn-primary" id="drawButton" aria-describedby="drawHelp">
                        ðŸŽ¯ Draw Number
                    </button>
                    <button class="btn btn-secondary" id="resetButton" aria-describedby="resetHelp">
                        ðŸ”„ Reset Game
                    </button>
                    <button class="btn btn-tertiary" id="copyButton" aria-describedby="copyHelp">
                        ðŸ“‹ Copy History
                    </button>
                </div>

                <div class="counters">
                    <div class="counter">
                        <div class="counter-number" id="drawnCount">0</div>
                        <div class="counter-label">Drawn</div>
                    </div>
                    <div class="counter">
                        <div class="counter-number" id="remainingCount">75</div>
                        <div class="counter-label">Remaining</div>
                    </div>
                </div>

                <div id="gameComplete" class="game-complete" style="display: none;">
                    <h2>ðŸŽ‰ All numbers called!</h2>
                    <p>Great job, caller! Time for a new game.</p>
                </div>

                <section class="bingo-grid">
                    <div class="grid-header">
                        <div class="letter-header">B</div>
                        <div class="letter-header">I</div>
                        <div class="letter-header">N</div>
                        <div class="letter-header">G</div>
                        <div class="letter-header">O</div>
                    </div>
                    <div class="numbers-grid" id="numbersGrid"></div>
                </section>
            </div>

            <aside class="right-panel">
                <div class="history-header">
                    <h2 class="history-title">ðŸ“œ Call History</h2>
                </div>
                <div class="history-list" id="historyList">
                    <p style="text-align: center; color: #666; font-style: italic;">
                        Numbers will appear here as they're called
                    </p>
                </div>
            </aside>
        </main>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <h3 id="modalTitle">Confirm Reset</h3>
            <p id="modalMessage">Are you sure you want to reset the game?</p>
            <div class="modal-buttons">
                <button class="btn btn-primary" id="modalYes">Yes</button>
                <button class="btn btn-secondary" id="modalNo">No</button>
            </div>
        </div>
    </div>

    <!-- Hidden help text for screen readers -->
    <div class="sr-only">
        <div id="drawHelp">Press Space or Enter to draw a number</div>
        <div id="resetHelp">Press R to reset the game</div>
        <div id="copyHelp">Copy the call history to clipboard</div>
    </div>

    <script>
        (() => {
            'use strict';

            // Game state
            let remainingNumbers = [];
            let calledNumbers = [];
            let currentNumber = null;
            let isResetting = false;
            let resetStep = 0;
            let winners = new Set();

            // Bingo card definitions with unique 5-letter IDs
            const bingoCards = {
                'PARRT': {
                    B: [7, 14, 2, 9, 12],
                    I: [22, 29, 16, 25, 18],
                    N: [31, 44, 'FREE', 33, 41],
                    G: [56, 49, 52, 47, 60],
                    O: [61, 74, 67, 71, 63]
                },
                'SQAWK': {
                    B: [5, 11, 8, 15, 3],
                    I: [28, 17, 24, 30, 19],
                    N: [34, 45, 'FREE', 38, 32],
                    G: [58, 51, 46, 54, 59],
                    O: [65, 72, 68, 75, 64]
                },
                'WINGS': {
                    B: [13, 6, 10, 4, 1],
                    I: [21, 26, 20, 23, 27],
                    N: [37, 42, 'FREE', 35, 43],
                    G: [50, 57, 48, 53, 55],
                    O: [69, 66, 73, 62, 70]
                },
                'FLYER': {
                    B: [9, 15, 1, 11, 6],
                    I: [18, 30, 23, 16, 28],
                    N: [39, 31, 'FREE', 44, 36],
                    G: [52, 60, 47, 55, 49],
                    O: [74, 61, 70, 68, 65]
                },
                'BIRDY': {
                    B: [8, 2, 14, 7, 13],
                    I: [25, 19, 27, 21, 24],
                    N: [40, 35, 'FREE', 42, 38],
                    G: [56, 48, 59, 51, 46],
                    O: [67, 75, 62, 71, 69]
                }
            };

            // DOM elements
            const elements = {
                drawButton: document.getElementById('drawButton'),
                resetButton: document.getElementById('resetButton'),
                copyButton: document.getElementById('copyButton'),
                currentNumber: document.getElementById('currentNumber'),
                currentLetter: document.getElementById('currentLetter'),
                drawnCount: document.getElementById('drawnCount'),
                remainingCount: document.getElementById('remainingCount'),
                historyList: document.getElementById('historyList'),
                numbersGrid: document.getElementById('numbersGrid'),
                gameComplete: document.getElementById('gameComplete'),
                squawkBubble: document.getElementById('squawkBubble'),
                announcer: document.getElementById('announcer'),
                confirmModal: document.getElementById('confirmModal'),
                modalTitle: document.getElementById('modalTitle'),
                modalMessage: document.getElementById('modalMessage'),
                modalYes: document.getElementById('modalYes'),
                modalNo: document.getElementById('modalNo'),
                winnerAlerts: document.getElementById('winnerAlerts'),
                winnerList: document.getElementById('winnerList')
            };

            // Initialize the game
            function initializeGame() {
                remainingNumbers = [];
                calledNumbers = [];
                currentNumber = null;
                isResetting = false;
                resetStep = 0;
                winners.clear();

                // Fill remaining numbers array with 1-75
                for (let i = 1; i <= 75; i++) {
                    remainingNumbers.push(i);
                }

                // Reset UI
                elements.currentNumber.textContent = '--';
                elements.currentLetter.textContent = 'Ready to play!';
                elements.gameComplete.style.display = 'none';
                elements.drawButton.disabled = false;
                elements.winnerAlerts.classList.remove('show');
                
                updateCounters();
                updateHistoryUI();
                createNumbersGrid();
                hideModal();

                // Broadcast reset to all card windows
                broadcastToCards({ type: 'reset' });
            }

            // Get letter group for a number
            function getLetterForNumber(num) {
                if (num >= 1 && num <= 15) return 'B';
                if (num >= 16 && num <= 30) return 'I';
                if (num >= 31 && num <= 45) return 'N';
                if (num >= 46 && num <= 60) return 'G';
                if (num >= 61 && num <= 75) return 'O';
                return '';
            }

            // Check for bingo on a specific card
            function checkBingo(cardId) {
                const card = bingoCards[cardId];
                if (!card) return false;

                // Check rows
                for (let row = 0; row < 5; row++) {
                    let rowComplete = true;
                    const letters = ['B', 'I', 'N', 'G', 'O'];
                    for (let col = 0; col < 5; col++) {
                        const cellValue = card[letters[col]][row];
                        if (cellValue !== 'FREE' && !calledNumbers.includes(cellValue)) {
                            rowComplete = false;
                            break;
                        }
                    }
                    if (rowComplete) return true;
                }

                // Check columns
                const letters = ['B', 'I', 'N', 'G', 'O'];
                for (let col = 0; col < 5; col++) {
                    let colComplete = true;
                    for (let row = 0; row < 5; row++) {
                        const cellValue = card[letters[col]][row];
                        if (cellValue !== 'FREE' && !calledNumbers.includes(cellValue)) {
                            colComplete = false;
                            break;
                        }
                    }
                    if (colComplete) return true;
                }

                // Check diagonals
                // Top-left to bottom-right
                let diagonal1Complete = true;
                for (let i = 0; i < 5; i++) {
                    const cellValue = card[letters[i]][i];
                    if (cellValue !== 'FREE' && !calledNumbers.includes(cellValue)) {
                        diagonal1Complete = false;
                        break;
                    }
                }
                if (diagonal1Complete) return true;

                // Top-right to bottom-left
                let diagonal2Complete = true;
                for (let i = 0; i < 5; i++) {
                    const cellValue = card[letters[i]][4 - i];
                    if (cellValue !== 'FREE' && !calledNumbers.includes(cellValue)) {
                        diagonal2Complete = false;
                        break;
                    }
                }
                if (diagonal2Complete) return true;

                return false;
            }

            // Check all cards for winners
            function checkAllCardsForWinners() {
                const newWinners = [];
                
                Object.keys(bingoCards).forEach(cardId => {
                    if (!winners.has(cardId) && checkBingo(cardId)) {
                        winners.add(cardId);
                        newWinners.push(cardId);
                    }
                });

                if (newWinners.length > 0) {
                    updateWinnerDisplay();
                    // Announce new winners
                    elements.announcer.textContent = `BINGO! Winners: ${Array.from(winners).join(', ')}`;
                }
            }

            // Update winner display
            function updateWinnerDisplay() {
                if (winners.size > 0) {
                    elements.winnerList.innerHTML = Array.from(winners).map(cardId => 
                        `<div class="winner-card">Card ${cardId}</div>`
                    ).join('');
                    elements.winnerAlerts.classList.add('show');
                } else {
                    elements.winnerAlerts.classList.remove('show');
                }
            }

            // Broadcast message to all card windows
            function broadcastToCards(message) {
                // Use localStorage to communicate with card windows
                const timestamp = Date.now();
                const messageWithTimestamp = { ...message, timestamp };
                localStorage.setItem('bingoCallerMessage', JSON.stringify(messageWithTimestamp));
                
                // Clean up old message after a short delay
                setTimeout(() => {
                    const current = localStorage.getItem('bingoCallerMessage');
                    if (current) {
                        const parsed = JSON.parse(current);
                        if (parsed.timestamp === timestamp) {
                            localStorage.removeItem('bingoCallerMessage');
                        }
                    }
                }, 1000);
            }

            // Draw the next number
            function drawNextNumber() {
                if (remainingNumbers.length === 0 || isResetting) return;

                // Prevent double clicks
                elements.drawButton.disabled = true;

                // Remove current highlight
                if (currentNumber) {
                    const prevCell = document.querySelector(`[data-number="${currentNumber}"]`);
                    if (prevCell) {
                        prevCell.classList.remove('current');
                    }
                }

                // Pick random number from remaining
                const randomIndex = Math.floor(Math.random() * remainingNumbers.length);
                const drawnNumber = remainingNumbers.splice(randomIndex, 1)[0];
                
                currentNumber = drawnNumber;
                calledNumbers.unshift(drawnNumber); // Add to beginning for reverse chronological order

                const letter = getLetterForNumber(drawnNumber);
                
                // Update display
                elements.currentNumber.textContent = drawnNumber;
                elements.currentLetter.textContent = `${letter} - ${drawnNumber}`;

                // Announce for screen readers
                elements.announcer.textContent = `${letter} ${drawnNumber}`;

                // Show squawk bubble
                showSquawk();

                // Update UI
                updateCounters();
                updateHistoryUI();
                updateGridUI();

                // Broadcast to card windows
                broadcastToCards({ 
                    type: 'numberCalled', 
                    number: drawnNumber, 
                    letter: letter,
                    calledNumbers: [...calledNumbers]
                });

                // Check for winners
                setTimeout(() => {
                    checkAllCardsForWinners();
                }, 500);

                // Check if game is complete
                if (remainingNumbers.length === 0) {
                    elements.gameComplete.style.display = 'block';
                    elements.drawButton.disabled = true;
                } else {
                    // Re-enable button after short delay to prevent spam
                    setTimeout(() => {
                        elements.drawButton.disabled = false;
                    }, 500);
                }
            }

            // Show squawk animation
            function showSquawk() {
                const messages = ['Squawk!', 'BINGO!', 'Tweet!', 'Chirp!'];
                const randomMessage = messages[Math.floor(Math.random() * messages.length)];
                elements.squawkBubble.textContent = randomMessage;
                elements.squawkBubble.classList.add('show');
                setTimeout(() => {
                    elements.squawkBubble.classList.remove('show');
                }, 2000);
            }

            // Update counters
            function updateCounters() {
                elements.drawnCount.textContent = calledNumbers.length;
                elements.remainingCount.textContent = remainingNumbers.length;
            }

            // Update history display
            function updateHistoryUI() {
                if (calledNumbers.length === 0) {
                    elements.historyList.innerHTML = `
                        <p style="text-align: center; color: #666; font-style: italic;">
                            Numbers will appear here as they're called
                        </p>
                    `;
                    return;
                }

                elements.historyList.innerHTML = calledNumbers.map(num => {
                    const letter = getLetterForNumber(num);
                    return `
                        <div class="history-item">
                            <span class="history-number">${letter}-${num}</span>
                        </div>
                    `;
                }).join('');
            }

            // Create the numbers grid
            function createNumbersGrid() {
                elements.numbersGrid.innerHTML = '';
                
                for (let i = 1; i <= 75; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'number-cell';
                    cell.textContent = i;
                    cell.setAttribute('data-number', i);
                    cell.setAttribute('aria-label', `${getLetterForNumber(i)} ${i}`);
                    elements.numbersGrid.appendChild(cell);
                }
            }

            // Update grid visual state
            function updateGridUI() {
                // Mark called numbers
                calledNumbers.forEach(num => {
                    const cell = document.querySelector(`[data-number="${num}"]`);
                    if (cell && !cell.classList.contains('called')) {
                        cell.classList.add('called');
                    }
                });

                // Highlight current number
                if (currentNumber) {
                    const currentCell = document.querySelector(`[data-number="${currentNumber}"]`);
                    if (currentCell) {
                        currentCell.classList.add('current');
                        // Remove current highlight after animation
                        setTimeout(() => {
                            if (currentCell.classList.contains('current')) {
                                currentCell.classList.remove('current');
                            }
                        }, 3000);
                    }
                }
            }

            // Show modal
            function showModal(title, message, onYes) {
                elements.modalTitle.textContent = title;
                elements.modalMessage.textContent = message;
                elements.confirmModal.classList.add('show');
                
                // Focus the Yes button for accessibility
                elements.modalYes.focus();
                
                // Set up event handlers
                elements.modalYes.onclick = () => {
                    hideModal();
                    onYes();
                };
                
                elements.modalNo.onclick = hideModal;
            }

            // Hide modal
            function hideModal() {
                elements.confirmModal.classList.remove('show');
                resetStep = 0;
                isResetting = false;
            }

            // Double confirmation reset
            function resetWithDoubleConfirm() {
                if (isResetting) return;
                
                isResetting = true;
                resetStep = 1;

                showModal(
                    'Confirm Reset',
                    'Are you sure you want to reset the game?',
                    () => {
                        resetStep = 2;
                        showModal(
                            'Really Reset?',
                            'Really reset? This will clear all history and winners.',
                            () => {
                                initializeGame();
                            }
                        );
                    }
                );
            }

            // Copy history to clipboard
            async function copyHistoryToClipboard() {
                if (calledNumbers.length === 0) {
                    alert('No numbers have been called yet!');
                    return;
                }

                const historyText = calledNumbers.map(num => {
                    const letter = getLetterForNumber(num);
                    return `${letter}-${num}`;
                }).join(', ');

                try {
                    await navigator.clipboard.writeText(historyText);
                    
                    // Visual feedback
                    const originalText = elements.copyButton.textContent;
                    elements.copyButton.textContent = 'âœ… Copied!';
                    elements.copyButton.style.background = 'linear-gradient(45deg, #4CAF50, #66BB6A)';
                    
                    setTimeout(() => {
                        elements.copyButton.textContent = originalText;
                        elements.copyButton.style.background = '';
                    }, 2000);
                } catch (err) {
                    // Fallback for older browsers
                    const textarea = document.createElement('textarea');
                    textarea.value = historyText;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    
                    alert('History copied to clipboard!');
                }
            }

            // Event listeners
            elements.drawButton.addEventListener('click', drawNextNumber);
            elements.resetButton.addEventListener('click', resetWithDoubleConfirm);
            elements.copyButton.addEventListener('click', copyHistoryToClipboard);

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                // Ignore if modal is open or user is typing in an input
                if (elements.confirmModal.classList.contains('show') || 
                    e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                    return;
                }

                switch (e.key.toLowerCase()) {
                    case ' ':
                    case 'enter':
                        e.preventDefault();
                        if (!elements.drawButton.disabled) {
                            drawNextNumber();
                        }
                        break;
                    case 'r':
                        e.preventDefault();
                        resetWithDoubleConfirm();
                        break;
                }
            });

            // Close modal on Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && elements.confirmModal.classList.contains('show')) {
                    hideModal();
                }
            });

            // Close modal when clicking outside
            elements.confirmModal.addEventListener('click', (e) => {
                if (e.target === elements.confirmModal) {
                    hideModal();
                }
            });

            // Initialize the game on load
            initializeGame();
        })();
    </script>
</body>
</html>
